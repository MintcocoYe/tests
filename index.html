  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Knowledge Graph</title>
  <style> body { margin: 0; } </style>

  <script src="//unpkg.com/3d-force-graph"></script>
  <script type="importmap">
    {
      "imports": {
        "three": "//unpkg.com/three/build/three.module.js"
      }
    }
  </script>
</head>

<body>
  <div id="3d-graph" style="width: 100vw; height: 100vh;"></div>

  <script type="module">
    import SpriteText from "//unpkg.com/three-spritetext/dist/three-spritetext.mjs";


    const data1 = {
  "Housing Affordability": ["AHINC", "FINC", "GRNT", "RNT", "SMOC", "MRG", "MRGT", "MRGX", "GRPI", "OCPI"],
  "Housing Patterns": ["BDS", "RMS", "NP", "NPF", "NOC", "R18", "R60", "R65", "MULTG", "HFL", "HHLDRACE", "HHLDRAGE", "HHLDSCHL"],
  "Housing Vacancies and Homeownership": ["VACS", "TEN", "HINC", "VAL", "FMRGX", "FMRGT"],
  "New Residential Construction": ["BATH", "KIT", "PLM", "RMS", "YBL", "MVY", "ELE", "GAS", "WAT", "BLD", "SMXH", "SMXS"],
  "Rental Housing Finance Survey (RHFS)": ["GRNT", "RNT", "GRPI", "SMOC", "MRG", "RNTM", "SRNT"],
  "Residential Finance Survey (RFS)": ["MRG", "MRGT", "MRGI", "MRGX", "SMOC", "SMXH", "SMXS", "VAL"]
};
    const data2 = {
  "Housing Affordability": ["AHSINC", "AHSMORT", "AHSRENT"],
  "Housing Patterns": ["AHSPATTERN1", "AHSPATTERN2"],
  "Housing Vacancies and Homeownership": ["AHSHOME1", "AHSHOME2"],
  "New Residential Construction": ["AHSNEWCON1", "AHSNEWCON2"],
  "Rental Housing Finance Survey (RHFS)": ["AHSRHFS1", "AHSRHFS2"],
  "Residential Finance Survey (RFS)": ["AHSRFS1", "AHSRFS2"]
};
    const datasets = [
  { name: "American Community Survey", data: data1 },
  { name: "American Housing Survey", data: data2 },
  // Add other datasets here: { name: "IPUMS 1940", data: data3 }, etc.
];

const gData = {
  nodes: [
    // First-Level Nodes (Datasets)
    { id: "American Community Survey", group: 1 },
    { id: "American Housing Survey", group: 1 },
    // Add other dataset nodes
    { id: "IPUMS 1940", group: 1 },
    { id: "CPS", group: 1 },
    { id: "Decennial Census 2010", group: 1 },
    { id: "Family Options Study", group: 1 },
    { id: "Moving to Opportunity", group: 1 },
    { id: "NCVS 2017", group: 1 },
    { id: "NSCH 2020", group: 1 },

    // Third-Level Nodes (Categories)
    { id: "Housing Affordability", group: 3 },
    { id: "Housing Patterns", group: 3 },
    { id: "Housing Vacancies and Homeownership", group: 3 },
    { id: "New Residential Construction", group: 3 },
    { id: "Rental Housing Finance Survey (RHFS)", group: 3 },
    { id: "Residential Finance Survey (RFS)", group: 3 }
  ],
  links: []
};

// Loop through each dataset and populate nodes and links dynamically
datasets.forEach(dataset => {
  const { name, data } = dataset;

  // Loop through the categories within each dataset
  Object.keys(data).forEach(category => {
    data[category].forEach(code => {
      // Add second-level nodes for each code
      gData.nodes.push({ id: code, group: 2 });

      // Create a link from the dataset to the code
      gData.links.push({ source: name, target: code, value: 1 });

      // Create a link from the code to the category
      gData.links.push({ source: category, target: code, value: 1 });
    });
  });
});

// Log the final graph data structure (for debugging)
console.log(gData);
   
    const Graph = ForceGraph3D()(document.getElementById('3d-graph'))
      .graphData(gData)
      .nodeAutoColorBy('group')
      .nodeThreeObject(node => {
        const sprite = new SpriteText(node.id);
        sprite.material.depthWrite = false; // Make sprite background transparent
        sprite.color = node.color;
        sprite.textHeight = 5; // Smaller text to make it more readable
        return sprite;
      });

    // Strengthen the connections and bring nodes closer
    Graph.d3Force('charge').strength(-50);  // Smaller negative charge for closer nodes
    Graph.d3Force('link').distance(50);     // Reduce link distance to bring nodes together
  </script>
</body>
</html>     
